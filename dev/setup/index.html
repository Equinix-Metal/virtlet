<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Setting up the environment - Virtlet</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Setting up the environment";
    var mkdocs_page_input_path = "dev/setup.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Virtlet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user-guide/virtlet-on-kdc/">Installing Virtlet on kubeadm-dind-cluster</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user-guide/real-cluster/">Installing Virtlet on a real cluster</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user-guide/apparmor/">AppArmor profiles</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Virtlet 101</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../101/architecture/">Virtlet architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/workshop-setup/">Workshop setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/provision-virtlet/">Virtlet provisioning</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/creating-and-managing-pods/">Creating and managing virtual machines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/network/">Virtlet networking</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/volumes/">Virtual machine volumes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/cloud-init/">Cloud-Init support</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/rolling-out-updates/">Rolling out updates</a>
                </li>
                <li class="">
                    
    <a class="" href="../../101/troubleshooting/">Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../reference/vm-pod-spec/">Defining a VM Pod</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/vm-pod/">Working with VM Pods</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/volumes/">Volumes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/images/">VM Image Handling</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/injecting-files/">Injecting Files into the VM</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/cloud-init/">Cloud-Init</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/config/">Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/networking/">Networking</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/diagnostics/">Diagnostics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/resources/">Resource management</a>
                </li>
                <li class="">
                    
    <a class="" href="../../reference/virtletctl/">Command Line Tool</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../architecture/">Virtlet architecture</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Setting up the environment</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#prerequisites">Prerequisites</a></li>
    

    <li class="toctree-l3"><a href="#running-the-local-environment">Running the local environment</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tests/">Running the tests</a>
                </li>
                <li class="">
                    
    <a class="" href="../build-tool/">Build Tool</a>
                </li>
                <li class="">
                    
    <a class="" href="../virtlet-ci/">Virtlet CI</a>
                </li>
                <li class="">
                    
    <a class="" href="../cirros/">Building a custom CirrOS image</a>
                </li>
                <li class="">
                    
    <a class="" href="../logging/">Logging architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../vm-pod-lifecycle/">Lifecycle of a VM pod</a>
                </li>
                <li class="">
                    
    <a class="" href="../guidelines/">Guidelines</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Virtlet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>Setting up the environment</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="prerequisites">Prerequisites</h2>
<p>You'll need the following to run the local environment:</p>
<ul>
<li>SELinux/AppArmor disabled on the host (to disable them, follow the
  documentation ofthe Linux distribution that you run on the host)</li>
<li>if host have libvirt installed, it should be stopped when working
  with Virtlet</li>
<li><a href="https://www.docker.com">Docker</a> should be installed on the host and
  the user account on which Virtlet will be built and run should be
  properly configured to use that Docker daemon (likely adding the
  user account into the group in which Docker deamon is running should
  be enough, but please follow the Docker documentation for your Linux
  distribution),</li>
<li><a href="https://github.com/kubernetes-sigs/kubeadm-dind-cluster/">kubeadm-dind-cluster</a>
  script for Kubernetes version 1.14 (<code>dind-cluster-v1.14.sh</code>).</li>
</ul>
<p>You can get the cluster startup script like this:</p>
<pre><code>$ wget -O ~/dind-cluster-v1.14.sh https://github.com/kubernetes-sigs/kubeadm-dind-cluster/releases/download/v0.1.0/dind-cluster-v1.14.sh
$ chmod +x ~/dind-cluster-v1.14.sh
</code></pre>

<h2 id="running-the-local-environment">Running the local environment</h2>
<p>In order to start locally-built Virtlet and CRI proxy on <code>kubeadm-dind-cluster</code>: </p>
<pre><code>$ # Remove any previous build container &amp; related docker volumes
$ # This is optional step that should be done if the build container
$ # doesn't match current Virtlet sources (i.e. is too old)
$ build/cmd.sh clean

$ # build Virtlet binaries &amp; the image
$ build/cmd.sh build

$ # start DIND cluster
$ ~/dind-cluster-v1.14.sh up

$ # copy binaries to kube-node-1
$ build/cmd.sh copy-dind

$ # inject Virtlet image into the DIND node and start the Virtlet DaemonSet
$ build/cmd.sh start-dind

$ # run some e2e tests
$ build/cmd.sh e2e -test.v

$ # run e2e tests that have 'Should have default route' in their description
$ build/cmd.sh e2e -test.v -ginkgo.focus=&quot;Should have default route&quot;

$ # Restart the DIND cluster. Binaries from copy-dind are preserved
$ # (you may copy newer ones with another copy-dind command)
$ ~/dind-cluster-v1.14.sh up

$ # start Virtlet daemonset again
$ build/cmd.sh start-dind
</code></pre>

<p>You may use <a href="https://github.com/coreos/flannel">flannel</a> instead of
default CNI bridge networking for the test cluster. To do so,
set <code>CNI_PLUGIN</code> environment variable:</p>
<pre><code>$ export CNI_PLUGIN=flannel
</code></pre>

<p>Virtlet uses KVM if it's available by default. To disable it for your
local development environment, set <code>VIRTLET_DISABLE_KVM</code> environment
variable to a non-empty value before running <code>build/cmd.sh start-dind</code>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tests/" class="btn btn-neutral float-right" title="Running the tests">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../architecture/" class="btn btn-neutral" title="Virtlet architecture"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../architecture/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../tests/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
